<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Cell Defense 인터랙티브 튜토리얼</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      margin: 0; padding: 20px;
      background: #1a1a1a;
      color: #eee;
      font-family: 'Press Start 2P', monospace;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      color: #4a8;
      margin-bottom: 24px;
    }
    p {
      max-width: 800px;
      margin: 16px auto;
      font-size: 14px;
    }
    .demo-box {
      position: relative;
      max-width: 800px;
      margin: 24px auto;
      padding: 12px;
      background: #0f0f0f;
      border: 4px solid #4a8;
      box-shadow: inset 0 0 0 4px #030;
    }
    .demo-title {
      margin: 0 0 8px;
      font-size: 16px;
      color: #4a8;
    }
    .demo-ui {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 12px;
    }
    .demo-ui button {
      background: #4a8; color: #000;
      border: 4px solid #030; padding: 6px 12px;
      cursor: pointer; image-rendering: pixelated;
    }
    .demo-ui button:disabled {
      background: #333; color: #555; border-color: #555; cursor: default;
    }
    .demo-canvas {
      display: block;
      background: #000;
      border: 4px solid #4a8;
      image-rendering: pixelated;
      margin: 0 auto;
    }
    .info-panel {
      position: absolute;
      background: rgba(17,17,17,0.9);
      border: 2px solid #4a8;
      padding: 6px;
      font-size: 12px;
      color: #eee;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h1>Cell Defense 인터랙티브 튜토리얼</h1>

  <p>
    <strong>1. 설치 미리보기 &amp; 사거리 표시</strong><br>
    “기본 세포” 버튼을 누르면, 마우스를 움직일 때 반투명 기물 모형과 점선으로 사거리가 표시되고<br>
    클릭하면 설치됩니다.
  </p>
  <div class="demo-box" id="demo1">
    <div class="demo-title">데모 1: 설치 미리보기 &amp; 사거리</div>
    <div class="demo-ui">
      <button id="d1-basicBtn">기본 세포 선택</button>
    </div>
    <canvas id="d1-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p>
    <strong>2. 뉴런 세포 전격 공격 &amp; 적 클릭 정보 표시</strong><br>
    “뉴런 설치” → “웨이브 시작” 버튼으로 적을 소환하고,<br>
    뉴런 세포는 자동으로 전격을 발사합니다. 이동 중인 적을 클릭하면 정보 패널이 나타납니다.
  </p>
  <div class="demo-box" id="demo2">
    <div class="demo-title">데모 2: 뉴런 전격 공격 &amp; 정보 표시</div>
    <div class="demo-ui">
      <button id="d2-placeBtn">뉴런 설치 모드</button>
      <button id="d2-waveBtn" disabled>웨이브 시작</button>
    </div>
    <canvas id="d2-canvas" class="demo-canvas" width="400" height="200"></canvas>
    <div id="d2-info" class="info-panel" style="display:none;"></div>
  </div>

  <p>
    <strong>3. ATP &amp; 비용 상승</strong><br>
    기본 비용 50 ATP로 세포를 설치할 때마다 비용이 +10% 상승하고,<br>
    설치·업그레이드 시 ATP가 차감됩니다.
  </p>
  <div class="demo-box" id="demo3">
    <div class="demo-title">데모 3: ATP &amp; 비용 상승</div>
    <div class="demo-ui">
      <button id="d3-basicBtn">기본 세포 설치</button>
      <button id="d3-upgradeBtn" disabled>업그레이드</button>
      <span>ATP: <span id="d3-atp">200</span></span>
      <span>설치 비용: <span id="d3-cost">50</span></span>
      <span>업그레이드 비용: <span id="d3-upcost">50</span></span>
    </div>
    <canvas id="d3-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p>
    <strong>4. 진화 효과</strong><br>
    업그레이드 레벨 5가 되면 “진화” 버튼이 활성화되고,<br>
    클릭 시 반짝이는 이펙트와 함께 성능이 대폭 강화됩니다.
  </p>
  <div class="demo-box" id="demo4">
    <div class="demo-title">데모 4: 식물 세포 설치 &amp; 진화</div>
    <div class="demo-ui">
      <button id="d4-placeBtn">식물 세포 설치</button>
      <button id="d4-upgradeBtn" disabled>업그레이드</button>
      <button id="d4-evolveBtn" disabled>진화</button>
    </div>
    <canvas id="d4-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p style="text-align:center; margin-top:32px;">
    🎉 모든 데모 완료!<br>
    이제 <button onclick="location.href='main.html'">메인 메뉴로 돌아가기</button>
  </p>

  <script>
    // --- 이미지 로드 (실제 게임과 동일) ---
    const imgCell   = new Image(); imgCell.src   = 'images/cell.png';
    const imgNeuron = new Image(); imgNeuron.src = 'images/new.png';
    const imgPlant  = new Image(); imgPlant.src  = 'images/plant.png';
    const imgVirus  = new Image(); imgVirus.src  = 'images/세균.png';

    function drawCellImage(cell, ctx) {
      if (cell.type==='plant')  ctx.drawImage(imgPlant,  cell.x-20, cell.y-30, 40,60);
      if (cell.type==='basic')  ctx.drawImage(imgCell,   cell.x-20, cell.y-20, 40,40);
      if (cell.type==='neuron') ctx.drawImage(imgNeuron, cell.x-20, cell.y-20, 40,40);
    }

    //
    // 데모 1: 설치 미리보기 & 사거리
    //
    (function(){
      const canvas = document.getElementById('d1-canvas'),
            ctx    = canvas.getContext('2d'),
            btn    = document.getElementById('d1-basicBtn');
      let placing=false, mx=0, my=0, cells=[];
      btn.onclick = ()=>{
        placing = !placing;
        btn.textContent = placing? '기본 세포 모드: ON' : '기본 세포 선택';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', ()=>{
        if (!placing) return;
        cells.push({x:mx,y:my,type:'basic'});
        placing=false;
        btn.textContent='기본 세포 선택';
      });
      (function loop(){
        ctx.clearRect(0,0,400,200);
        cells.forEach(c=> drawCellImage(c,ctx));
        if (placing) {
          ctx.save(); ctx.globalAlpha=0.4;
          drawCellImage({x:mx,y:my,type:'basic'},ctx);
          ctx.restore();
          ctx.strokeStyle='white'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(mx,my,60,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
        }
        requestAnimationFrame(loop);
      })();
    })();

    //
    // 데모 2: 뉴런 전격 공격 & 정보 표시
    //
    (function(){
      const box      = document.getElementById('demo2'),
            canvas   = document.getElementById('d2-canvas'),
            ctx      = canvas.getContext('2d'),
            placeBtn = document.getElementById('d2-placeBtn'),
            waveBtn  = document.getElementById('d2-waveBtn'),
            infoDiv  = document.getElementById('d2-info');
      let placing=false, cell=null, enemies=[], mx=0, my=0;
      box.style.position='relative';
      placeBtn.onclick = ()=>{
        placing = !placing;
        placeBtn.textContent = placing? '뉴런 모드: ON' : '뉴런 설치';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', () => {
        if (placing) {
          cell={x:mx,y:my,type:'neuron'};
          placing=false; placeBtn.textContent='뉴런 설치';
          waveBtn.disabled=false;
        } else {
          const hit = enemies.find(en=> Math.hypot(en.x-mx,en.y-my) < en.size );
          if (hit) {
            infoDiv.style.display='block';
            infoDiv.style.left=(hit.x+hit.size+8)+'px';
            infoDiv.style.top=(hit.y-hit.size)+'px';
            infoDiv.innerHTML=
              `<strong>적 정보</strong><br>
               타입: ${hit.type}<br>
               HP: ${Math.round(hit.hp)}<br>
               속도: ${hit.speed.toFixed(2)}`;
          } else {
            infoDiv.style.display='none';
          }
        }
      });
      waveBtn.onclick = ()=>{
        if (!cell) return;
        for(let i=0;i<3;i++){
          enemies.push({
            x:400, y:50 + i*50,
            hp:50, speed:0.7,
            type:'virus', size:15
          });
        }
        waveBtn.disabled=true;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        if (cell) {
          drawCellImage(cell,ctx);
          ctx.strokeStyle='#4a8'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(cell.x,cell.y,100,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
          enemies.forEach(e=>{
            if (Math.hypot(e.x-cell.x,e.y-cell.y)<=100) {
              ctx.strokeStyle='yellow'; ctx.lineWidth=2;
              ctx.beginPath(); ctx.moveTo(cell.x,cell.y);
              ctx.lineTo(e.x,e.y); ctx.stroke();
            }
          });
        }
        enemies = enemies.filter(e=>{
          if (e.hp<=0) return false;
          ctx.drawImage(imgVirus, e.x-e.size, e.y-e.size, e.size*2, e.size*2);
          e.x -= e.speed;
          return e.x > -e.size;
        });
        requestAnimationFrame(loop);
      })();
    })();

    //
    // 데모 3: ATP & 비용 상승
    //
    (function(){
      const canvas   = document.getElementById('d3-canvas'),
            ctx      = canvas.getContext('2d'),
            basicBtn = document.getElementById('d3-basicBtn'),
            upBtn    = document.getElementById('d3-upgradeBtn'),
            atpSpan  = document.getElementById('d3-atp'),
            costSpan = document.getElementById('d3-cost'),
            upcostSp = document.getElementById('d3-upcost');
      let ATP=200, count=0, cells=[], selected=null;
      const baseCost=50;
      let placeCost=baseCost;
      basicBtn.onclick = ()=>{
        if (ATP<placeCost) return;
        ATP -= placeCost; count++;
        cells.push({
          x:50 + count*30,
          y:100,
          type:'basic',
          damage:50,
          range:60,
          upgrade:0
        });
        placeCost = Math.max(Math.floor(baseCost*(1+count*0.1)), baseCost);
        atpSpan.textContent=ATP;
        costSpan.textContent=placeCost;
      };
      canvas.addEventListener('click', e=>{
        const r=canvas.getBoundingClientRect();
        const mx=e.clientX-r.left, my=e.clientY-r.top;
        selected = cells.find(c=> Math.hypot(c.x-mx,c.y-my)<20 );
        if (selected) {
          upBtn.disabled=false;
          let uc=Math.floor(50*(1+selected.upgrade*0.5));
          upcostSp.textContent=uc;
        }
      });
      upBtn.onclick = ()=>{
        if (!selected) return;
        let uc=Math.floor(50*(1+selected.upgrade*0.5));
        if (ATP<uc) return;
        ATP -= uc;
        selected.upgrade++;
        selected.damage+=10;
        selected.range +=10;
        upcostSp.textContent=Math.floor(50*(1+selected.upgrade*0.5));
        atpSpan.textContent=ATP;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        cells.forEach(c=>{
          drawCellImage(c,ctx);
          ctx.strokeStyle='#4a8'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(c.x,c.y,c.range,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
          if (selected===c) {
            ctx.strokeStyle='red'; ctx.lineWidth=3;
            ctx.beginPath(); ctx.arc(c.x,c.y,25,0,2*Math.PI); ctx.stroke();
            ctx.lineWidth=1;
          }
        });
        requestAnimationFrame(loop);
      })();
    })();

    //
    // 데모 4: 식물 세포 설치 & 진화
    //
    (function(){
      const canvas    = document.getElementById('d4-canvas'),
            ctx       = canvas.getContext('2d'),
            placeBtn  = document.getElementById('d4-placeBtn'),
            upBtn     = document.getElementById('d4-upgradeBtn'),
            evoBtn    = document.getElementById('d4-evolveBtn');
      let placing=false, cell=null, mx=0, my=0;
      placeBtn.onclick = ()=>{
        placing = !placing;
        placeBtn.textContent = placing? '식물 설치: ON' : '식물 설치';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', ()=>{
        if (!placing) return;
        cell = {
          x: mx,
          y: my,
          upgrade: 0,
          range: 80,
          hp: 500,
          maxHp: 500,
          evolved: false
        };
        placing=false; placeBtn.textContent='식물 설치';
        upBtn.disabled=false;
      });
      upBtn.onclick = ()=>{
        if (!cell) return;
        let uc = Math.floor(50*(1+cell.upgrade*0.5));
        cell.upgrade++;
        cell.range += 30;
        cell.hp    += 30;
        cell.maxHp += 30;
        if (cell.upgrade >= 5) {
          upBtn.disabled = true;
          evoBtn.disabled = false;
        }
      };
      evoBtn.onclick = ()=>{
        if (!cell || cell.upgrade<5) return;
        let frame = 0;
        function effect() {
          if (frame > 30) return;
          [30,40].forEach((r,idx)=>{
            ctx.save();
            ctx.globalAlpha = 1 - frame/30;
            ctx.strokeStyle = idx===0? '#fff700' : '#00f6ff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(cell.x,cell.y, r + frame*2, 0, 2*Math.PI);
            ctx.stroke();
            ctx.restore();
          });
          frame++;
          requestAnimationFrame(effect);
        }
        cell.evolved = true;
        effect();
        evoBtn.disabled = true;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        if (cell) {
          drawCellImage(cell,ctx);
          // HP bar
          ctx.fillStyle='black'; ctx.fillRect(cell.x-20,cell.y+35,40,6);
          ctx.fillStyle='lime';  ctx.fillRect(cell.x-20,cell.y+35,40*(cell.hp/cell.maxHp),6);
          ctx.strokeStyle='white'; ctx.strokeRect(cell.x-20,cell.y+35,40,6);
          // range
          ctx.strokeStyle = cell.evolved? '#ff0' : '#4a8';
          ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(cell.x,cell.y,cell.range,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
        }
        requestAnimationFrame(loop);
      })();
    })();
  </script>
</body>
</html>
