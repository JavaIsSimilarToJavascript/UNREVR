<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Cell Defense ì¸í„°ë™í‹°ë¸Œ íŠœí† ë¦¬ì–¼</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      margin: 0; padding: 20px;
      background: #1a1a1a;
      color: #eee;
      font-family: 'Press Start 2P', monospace;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      color: #4a8;
      margin-bottom: 24px;
    }
    p {
      max-width: 800px;
      margin: 16px auto;
      font-size: 14px;
    }
    .demo-box {
      position: relative;
      max-width: 800px;
      margin: 24px auto;
      padding: 12px;
      background: #0f0f0f;
      border: 4px solid #4a8;
      box-shadow: inset 0 0 0 4px #030;
    }
    .demo-title {
      margin: 0 0 8px;
      font-size: 16px;
      color: #4a8;
    }
    .demo-ui {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 12px;
    }
    .demo-ui button {
      background: #4a8; color: #000;
      border: 4px solid #030; padding: 6px 12px;
      cursor: pointer; image-rendering: pixelated;
    }
    .demo-ui button:disabled {
      background: #333; color: #555; border-color: #555; cursor: default;
    }
    .demo-canvas {
      display: block;
      background: #000;
      border: 4px solid #4a8;
      image-rendering: pixelated;
      margin: 0 auto;
    }
    .info-panel {
      position: absolute;
      background: rgba(17,17,17,0.9);
      border: 2px solid #4a8;
      padding: 6px;
      font-size: 12px;
      color: #eee;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h1>Cell Defense ì¸í„°ë™í‹°ë¸Œ íŠœí† ë¦¬ì–¼</h1>

  <p>
    <strong>1. ì„¤ì¹˜ ë¯¸ë¦¬ë³´ê¸° &amp; ì‚¬ê±°ë¦¬ í‘œì‹œ</strong><br>
    â€œê¸°ë³¸ ì„¸í¬â€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì¼ ë•Œ ë°˜íˆ¬ëª… ê¸°ë¬¼ ëª¨í˜•ê³¼ ì ì„ ìœ¼ë¡œ ì‚¬ê±°ë¦¬ê°€ í‘œì‹œë˜ê³ <br>
    í´ë¦­í•˜ë©´ ì„¤ì¹˜ë©ë‹ˆë‹¤.
  </p>
  <div class="demo-box" id="demo1">
    <div class="demo-title">ë°ëª¨ 1: ì„¤ì¹˜ ë¯¸ë¦¬ë³´ê¸° &amp; ì‚¬ê±°ë¦¬</div>
    <div class="demo-ui">
      <button id="d1-basicBtn">ê¸°ë³¸ ì„¸í¬ ì„ íƒ</button>
    </div>
    <canvas id="d1-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p>
    <strong>2. ë‰´ëŸ° ì„¸í¬ ì „ê²© ê³µê²© &amp; ì  í´ë¦­ ì •ë³´ í‘œì‹œ</strong><br>
    â€œë‰´ëŸ° ì„¤ì¹˜â€ â†’ â€œì›¨ì´ë¸Œ ì‹œì‘â€ ë²„íŠ¼ìœ¼ë¡œ ì ì„ ì†Œí™˜í•˜ê³ ,<br>
    ë‰´ëŸ° ì„¸í¬ëŠ” ìë™ìœ¼ë¡œ ì „ê²©ì„ ë°œì‚¬í•©ë‹ˆë‹¤. ì´ë™ ì¤‘ì¸ ì ì„ í´ë¦­í•˜ë©´ ì •ë³´ íŒ¨ë„ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
  </p>
  <div class="demo-box" id="demo2">
    <div class="demo-title">ë°ëª¨ 2: ë‰´ëŸ° ì „ê²© ê³µê²© &amp; ì •ë³´ í‘œì‹œ</div>
    <div class="demo-ui">
      <button id="d2-placeBtn">ë‰´ëŸ° ì„¤ì¹˜ ëª¨ë“œ</button>
      <button id="d2-waveBtn" disabled>ì›¨ì´ë¸Œ ì‹œì‘</button>
    </div>
    <canvas id="d2-canvas" class="demo-canvas" width="400" height="200"></canvas>
    <div id="d2-info" class="info-panel" style="display:none;"></div>
  </div>

  <p>
    <strong>3. ATP &amp; ë¹„ìš© ìƒìŠ¹</strong><br>
    ê¸°ë³¸ ë¹„ìš© 50 ATPë¡œ ì„¸í¬ë¥¼ ì„¤ì¹˜í•  ë•Œë§ˆë‹¤ ë¹„ìš©ì´ +10% ìƒìŠ¹í•˜ê³ ,<br>
    ì„¤ì¹˜Â·ì—…ê·¸ë ˆì´ë“œ ì‹œ ATPê°€ ì°¨ê°ë©ë‹ˆë‹¤.
  </p>
  <div class="demo-box" id="demo3">
    <div class="demo-title">ë°ëª¨ 3: ATP &amp; ë¹„ìš© ìƒìŠ¹</div>
    <div class="demo-ui">
      <button id="d3-basicBtn">ê¸°ë³¸ ì„¸í¬ ì„¤ì¹˜</button>
      <button id="d3-upgradeBtn" disabled>ì—…ê·¸ë ˆì´ë“œ</button>
      <span>ATP: <span id="d3-atp">200</span></span>
      <span>ì„¤ì¹˜ ë¹„ìš©: <span id="d3-cost">50</span></span>
      <span>ì—…ê·¸ë ˆì´ë“œ ë¹„ìš©: <span id="d3-upcost">50</span></span>
    </div>
    <canvas id="d3-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p>
    <strong>4. ì§„í™” íš¨ê³¼</strong><br>
    ì—…ê·¸ë ˆì´ë“œ ë ˆë²¨ 5ê°€ ë˜ë©´ â€œì§„í™”â€ ë²„íŠ¼ì´ í™œì„±í™”ë˜ê³ ,<br>
    í´ë¦­ ì‹œ ë°˜ì§ì´ëŠ” ì´í™íŠ¸ì™€ í•¨ê»˜ ì„±ëŠ¥ì´ ëŒ€í­ ê°•í™”ë©ë‹ˆë‹¤.
  </p>
  <div class="demo-box" id="demo4">
    <div class="demo-title">ë°ëª¨ 4: ì‹ë¬¼ ì„¸í¬ ì„¤ì¹˜ &amp; ì§„í™”</div>
    <div class="demo-ui">
      <button id="d4-placeBtn">ì‹ë¬¼ ì„¸í¬ ì„¤ì¹˜</button>
      <button id="d4-upgradeBtn" disabled>ì—…ê·¸ë ˆì´ë“œ</button>
      <button id="d4-evolveBtn" disabled>ì§„í™”</button>
    </div>
    <canvas id="d4-canvas" class="demo-canvas" width="400" height="200"></canvas>
  </div>

  <p style="text-align:center; margin-top:32px;">
    ğŸ‰ ëª¨ë“  ë°ëª¨ ì™„ë£Œ!<br>
    ì´ì œ <button onclick="location.href='main.html'">ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
  </p>

  <script>
    // --- ì´ë¯¸ì§€ ë¡œë“œ (ì‹¤ì œ ê²Œì„ê³¼ ë™ì¼) ---
    const imgCell   = new Image(); imgCell.src   = 'images/cell.png';
    const imgNeuron = new Image(); imgNeuron.src = 'images/new.png';
    const imgPlant  = new Image(); imgPlant.src  = 'images/plant.png';
    const imgVirus  = new Image(); imgVirus.src  = 'images/ì„¸ê· .png';

    function drawCellImage(cell, ctx) {
      if (cell.type==='plant')  ctx.drawImage(imgPlant,  cell.x-20, cell.y-30, 40,60);
      if (cell.type==='basic')  ctx.drawImage(imgCell,   cell.x-20, cell.y-20, 40,40);
      if (cell.type==='neuron') ctx.drawImage(imgNeuron, cell.x-20, cell.y-20, 40,40);
    }

    //
    // ë°ëª¨ 1: ì„¤ì¹˜ ë¯¸ë¦¬ë³´ê¸° & ì‚¬ê±°ë¦¬
    //
    (function(){
      const canvas = document.getElementById('d1-canvas'),
            ctx    = canvas.getContext('2d'),
            btn    = document.getElementById('d1-basicBtn');
      let placing=false, mx=0, my=0, cells=[];
      btn.onclick = ()=>{
        placing = !placing;
        btn.textContent = placing? 'ê¸°ë³¸ ì„¸í¬ ëª¨ë“œ: ON' : 'ê¸°ë³¸ ì„¸í¬ ì„ íƒ';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', ()=>{
        if (!placing) return;
        cells.push({x:mx,y:my,type:'basic'});
        placing=false;
        btn.textContent='ê¸°ë³¸ ì„¸í¬ ì„ íƒ';
      });
      (function loop(){
        ctx.clearRect(0,0,400,200);
        cells.forEach(c=> drawCellImage(c,ctx));
        if (placing) {
          ctx.save(); ctx.globalAlpha=0.4;
          drawCellImage({x:mx,y:my,type:'basic'},ctx);
          ctx.restore();
          ctx.strokeStyle='white'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(mx,my,60,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
        }
        requestAnimationFrame(loop);
      })();
    })();

    //
    // ë°ëª¨ 2: ë‰´ëŸ° ì „ê²© ê³µê²© & ì •ë³´ í‘œì‹œ
    //
    (function(){
      const box      = document.getElementById('demo2'),
            canvas   = document.getElementById('d2-canvas'),
            ctx      = canvas.getContext('2d'),
            placeBtn = document.getElementById('d2-placeBtn'),
            waveBtn  = document.getElementById('d2-waveBtn'),
            infoDiv  = document.getElementById('d2-info');
      let placing=false, cell=null, enemies=[], mx=0, my=0;
      box.style.position='relative';
      placeBtn.onclick = ()=>{
        placing = !placing;
        placeBtn.textContent = placing? 'ë‰´ëŸ° ëª¨ë“œ: ON' : 'ë‰´ëŸ° ì„¤ì¹˜';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', () => {
        if (placing) {
          cell={x:mx,y:my,type:'neuron'};
          placing=false; placeBtn.textContent='ë‰´ëŸ° ì„¤ì¹˜';
          waveBtn.disabled=false;
        } else {
          const hit = enemies.find(en=> Math.hypot(en.x-mx,en.y-my) < en.size );
          if (hit) {
            infoDiv.style.display='block';
            infoDiv.style.left=(hit.x+hit.size+8)+'px';
            infoDiv.style.top=(hit.y-hit.size)+'px';
            infoDiv.innerHTML=
              `<strong>ì  ì •ë³´</strong><br>
               íƒ€ì…: ${hit.type}<br>
               HP: ${Math.round(hit.hp)}<br>
               ì†ë„: ${hit.speed.toFixed(2)}`;
          } else {
            infoDiv.style.display='none';
          }
        }
      });
      waveBtn.onclick = ()=>{
        if (!cell) return;
        for(let i=0;i<3;i++){
          enemies.push({
            x:400, y:50 + i*50,
            hp:50, speed:0.7,
            type:'virus', size:15
          });
        }
        waveBtn.disabled=true;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        if (cell) {
          drawCellImage(cell,ctx);
          ctx.strokeStyle='#4a8'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(cell.x,cell.y,100,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
          enemies.forEach(e=>{
            if (Math.hypot(e.x-cell.x,e.y-cell.y)<=100) {
              ctx.strokeStyle='yellow'; ctx.lineWidth=2;
              ctx.beginPath(); ctx.moveTo(cell.x,cell.y);
              ctx.lineTo(e.x,e.y); ctx.stroke();
            }
          });
        }
        enemies = enemies.filter(e=>{
          if (e.hp<=0) return false;
          ctx.drawImage(imgVirus, e.x-e.size, e.y-e.size, e.size*2, e.size*2);
          e.x -= e.speed;
          return e.x > -e.size;
        });
        requestAnimationFrame(loop);
      })();
    })();

    //
    // ë°ëª¨ 3: ATP & ë¹„ìš© ìƒìŠ¹
    //
    (function(){
      const canvas   = document.getElementById('d3-canvas'),
            ctx      = canvas.getContext('2d'),
            basicBtn = document.getElementById('d3-basicBtn'),
            upBtn    = document.getElementById('d3-upgradeBtn'),
            atpSpan  = document.getElementById('d3-atp'),
            costSpan = document.getElementById('d3-cost'),
            upcostSp = document.getElementById('d3-upcost');
      let ATP=200, count=0, cells=[], selected=null;
      const baseCost=50;
      let placeCost=baseCost;
      basicBtn.onclick = ()=>{
        if (ATP<placeCost) return;
        ATP -= placeCost; count++;
        cells.push({
          x:50 + count*30,
          y:100,
          type:'basic',
          damage:50,
          range:60,
          upgrade:0
        });
        placeCost = Math.max(Math.floor(baseCost*(1+count*0.1)), baseCost);
        atpSpan.textContent=ATP;
        costSpan.textContent=placeCost;
      };
      canvas.addEventListener('click', e=>{
        const r=canvas.getBoundingClientRect();
        const mx=e.clientX-r.left, my=e.clientY-r.top;
        selected = cells.find(c=> Math.hypot(c.x-mx,c.y-my)<20 );
        if (selected) {
          upBtn.disabled=false;
          let uc=Math.floor(50*(1+selected.upgrade*0.5));
          upcostSp.textContent=uc;
        }
      });
      upBtn.onclick = ()=>{
        if (!selected) return;
        let uc=Math.floor(50*(1+selected.upgrade*0.5));
        if (ATP<uc) return;
        ATP -= uc;
        selected.upgrade++;
        selected.damage+=10;
        selected.range +=10;
        upcostSp.textContent=Math.floor(50*(1+selected.upgrade*0.5));
        atpSpan.textContent=ATP;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        cells.forEach(c=>{
          drawCellImage(c,ctx);
          ctx.strokeStyle='#4a8'; ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(c.x,c.y,c.range,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
          if (selected===c) {
            ctx.strokeStyle='red'; ctx.lineWidth=3;
            ctx.beginPath(); ctx.arc(c.x,c.y,25,0,2*Math.PI); ctx.stroke();
            ctx.lineWidth=1;
          }
        });
        requestAnimationFrame(loop);
      })();
    })();

    //
    // ë°ëª¨ 4: ì‹ë¬¼ ì„¸í¬ ì„¤ì¹˜ & ì§„í™”
    //
    (function(){
      const canvas    = document.getElementById('d4-canvas'),
            ctx       = canvas.getContext('2d'),
            placeBtn  = document.getElementById('d4-placeBtn'),
            upBtn     = document.getElementById('d4-upgradeBtn'),
            evoBtn    = document.getElementById('d4-evolveBtn');
      let placing=false, cell=null, mx=0, my=0;
      placeBtn.onclick = ()=>{
        placing = !placing;
        placeBtn.textContent = placing? 'ì‹ë¬¼ ì„¤ì¹˜: ON' : 'ì‹ë¬¼ ì„¤ì¹˜';
      };
      canvas.addEventListener('mousemove', e=>{
        const r=canvas.getBoundingClientRect();
        mx=e.clientX-r.left; my=e.clientY-r.top;
      });
      canvas.addEventListener('click', ()=>{
        if (!placing) return;
        cell = {
          x: mx,
          y: my,
          upgrade: 0,
          range: 80,
          hp: 500,
          maxHp: 500,
          evolved: false
        };
        placing=false; placeBtn.textContent='ì‹ë¬¼ ì„¤ì¹˜';
        upBtn.disabled=false;
      });
      upBtn.onclick = ()=>{
        if (!cell) return;
        let uc = Math.floor(50*(1+cell.upgrade*0.5));
        cell.upgrade++;
        cell.range += 30;
        cell.hp    += 30;
        cell.maxHp += 30;
        if (cell.upgrade >= 5) {
          upBtn.disabled = true;
          evoBtn.disabled = false;
        }
      };
      evoBtn.onclick = ()=>{
        if (!cell || cell.upgrade<5) return;
        let frame = 0;
        function effect() {
          if (frame > 30) return;
          [30,40].forEach((r,idx)=>{
            ctx.save();
            ctx.globalAlpha = 1 - frame/30;
            ctx.strokeStyle = idx===0? '#fff700' : '#00f6ff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(cell.x,cell.y, r + frame*2, 0, 2*Math.PI);
            ctx.stroke();
            ctx.restore();
          });
          frame++;
          requestAnimationFrame(effect);
        }
        cell.evolved = true;
        effect();
        evoBtn.disabled = true;
      };
      (function loop(){
        ctx.clearRect(0,0,400,200);
        if (cell) {
          drawCellImage(cell,ctx);
          // HP bar
          ctx.fillStyle='black'; ctx.fillRect(cell.x-20,cell.y+35,40,6);
          ctx.fillStyle='lime';  ctx.fillRect(cell.x-20,cell.y+35,40*(cell.hp/cell.maxHp),6);
          ctx.strokeStyle='white'; ctx.strokeRect(cell.x-20,cell.y+35,40,6);
          // range
          ctx.strokeStyle = cell.evolved? '#ff0' : '#4a8';
          ctx.setLineDash([5,5]);
          ctx.beginPath(); ctx.arc(cell.x,cell.y,cell.range,0,2*Math.PI); ctx.stroke();
          ctx.setLineDash([]);
        }
        requestAnimationFrame(loop);
      })();
    })();
  </script>
</body>
</html>
